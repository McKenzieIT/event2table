# Event2Table 后端优化计划

> **版本**: 2.0 | **创建日期**: 2026-02-20 | **状态**: 计划阶段

---

## 📋 优化目标

本次优化基于**6个并行subagent深度审查**，发现72+个优化点：

1. **提升安全性** - 修复SQL注入、XSS、异常泄露等安全问题（14个问题）
2. **提升性能** - 消除N+1查询、优化数据库查询、改进缓存（10个问题）
3. **提高可维护性** - 减少重复代码、拆分过长文件、完善类型注解（10个问题）
4. **规范架构** - 完善分层架构、统一API契约、迁移game_gid（38个问题）

---

## 📊 问题统计

| 审查维度 | 问题数 | P0 | P1 | P2 |
|---------|--------|----|----|-----|
| 架构与耦合 | 10 | 4 | 4 | 2 |
| 性能与数据库 | 10 | 3 | 6 | 1 |
| 安全漏洞 | 14 | 2 | 8 | 4 |
| 代码质量 | 10 | 3 | 4 | 3 |
| API契约 | 13 | 2 | 4 | 7 |
| game_gid合规 | 15 | 2 | 5 | 8 |
| **总计** | **72+** | **16** | **31** | **25** |

---

## 🚀 优化阶段

| 阶段 | 名称 | 问题数 | 预计时间 | 并行任务数 | 状态 |
|------|------|--------|---------|-----------|------|
| [Phase 0](./phase-0-emergency/plan.md) | 紧急修复 | 4 | 1-2h | 4 | 📋 计划中 |
| [Phase 1](./phase-1-security/plan.md) | 安全加固 | 8 | 2-3h | 3 | ⏳ 待开始 |
| [Phase 2](./phase-2-performance/plan.md) | 性能优化 | 10 | 3-4h | 3 | ⏳ 待开始 |
| [Phase 3](./phase-3-architecture/plan.md) | 架构重构 | 10 | 4-6h | 4 | ⏳ 待开始 |
| [Phase 4](./phase-4-code-quality/plan.md) | 代码质量 | 10 | 3-4h | 4 | ⏳ 待开始 |
| [Phase 5](./phase-5-game-gid-migration/plan.md) | game_gid迁移 | 15 | 4-5h | 5 | ⏳ 待开始 |

**总计**: 57个优化点，预计18-24小时

---

## 🔄 执行策略

### 渐进式重构原则

1. **每个阶段独立验证** - 完成一个阶段后运行测试，确保无回归
2. **完全切换game_gid** - 不保持向后兼容，前端同步修改
3. **文档驱动** - 每个阶段有详细的计划、执行日志、验证报告
4. **可回滚** - 使用git分支管理，随时可以回滚

### 并行优化策略

每个阶段使用多个subagent并行执行：

```
Phase 0 (紧急修复) - 4个并行subagent
├── Subagent 1: 修复异常信息泄露（56处）
├── Subagent 2: 修复GenericRepository SQL构建
├── Subagent 3: 修复缺少的导入
└── Subagent 4: 修复Session设置错误

Phase 1-5: 类似的并行结构
```

---

## 🔗 相关文档

- [CLAUDE.md](../../CLAUDE.md) - 开发规范
- [前端优化方案](./OPTIMIZATION-PROPOSAL.md) - 前端优化计划
- [前端优化进度](./OPTIMIZATION_PROGRESS.md) - 前端已完成优化

---

**创建日期**: 2026-02-20
**审查方式**: 6个并行subagent深度审查
**预计总工时**: 18-24小时
