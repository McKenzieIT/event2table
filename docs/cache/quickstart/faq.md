# ç¼“å­˜ç³»ç»Ÿå¸¸è§é—®é¢˜FAQ (Frequently Asked Questions)

> **é¢å‘**: æ‰€æœ‰ç”¨æˆ·
> **å†…å®¹**: æœ€å¸¸é‡åˆ°çš„10ä¸ªé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

---

## ğŸŸ¢ åŸºç¡€é—®é¢˜

### Q1: ç¼“å­˜å’Œæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

| ç‰¹æ€§ | æ•°æ®åº“ | ç¼“å­˜ |
|------|--------|------|
| **å­˜å‚¨ä»‹è´¨** | ç£ç›˜ | å†…å­˜ (RAM) |
| **è®¿é—®é€Ÿåº¦** | æ…¢ (100-500ms) | å¿« (1-10ms) |
| **æ•°æ®æŒä¹…æ€§** | æ°¸ä¹…å­˜å‚¨ | ä¸´æ—¶å­˜å‚¨ (TTLè¿‡æœŸ) |
| **ç”¨é€”** | æ•°æ®æŒä¹…åŒ– | æ€§èƒ½åŠ é€Ÿ |
| **æˆæœ¬** | å­˜å‚¨æˆæœ¬é«˜ | å†…å­˜æˆæœ¬é«˜ |

**æœ€ä½³å®è·µ**: æ•°æ®åº“ä½œä¸ºå”¯ä¸€æ•°æ®æºï¼Œç¼“å­˜ä½œä¸ºæ€§èƒ½åŠ é€Ÿå±‚ã€‚

---

### Q2: ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ç¼“å­˜ï¼Ÿ

**âœ… åº”è¯¥ä½¿ç”¨ç¼“å­˜çš„åœºæ™¯**:
- è¯»å¤šå†™å°‘çš„æ•°æ®ï¼ˆæ¸¸æˆåˆ—è¡¨ã€äº‹ä»¶é…ç½®ï¼‰
- è®¡ç®—æˆæœ¬é«˜çš„æŸ¥è¯¢ï¼ˆç»Ÿè®¡æŠ¥è¡¨ã€èšåˆåˆ†æï¼‰
- ä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ï¼ˆç³»ç»Ÿé…ç½®ã€å…ƒæ•°æ®ï¼‰
- é«˜å¹¶å‘è®¿é—®çš„APIï¼ˆçƒ­é—¨æŸ¥è¯¢ï¼‰

**âŒ ä¸åº”è¯¥ä½¿ç”¨ç¼“å­˜çš„åœºæ™¯**:
- å®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ï¼ˆåœ¨çº¿ç”¨æˆ·æ•°ã€å®æ—¶ç»Ÿè®¡ï¼‰
- é¢‘ç¹å˜åŒ–çš„æ•°æ®ï¼ˆç§’çº§æ›´æ–°çš„æ•°æ®ï¼‰
- å†™å¤šè¯»å°‘çš„æ•°æ®ï¼ˆæ—¥å¿—è®°å½•ã€æ“ä½œå†å²ï¼‰
- æ•°æ®é‡è¶…å¤§çš„ç»“æœé›†ï¼ˆ>1MBçš„å•ä¸ªç¼“å­˜é¡¹ï¼‰

---

### Q3: TTLè®¾ç½®å¤šå°‘åˆé€‚ï¼Ÿ

**TTL (Time To Live)**: ç¼“å­˜çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰

| æ•°æ®ç±»å‹ | æ¨èTTL | ç†ç”± |
|---------|---------|------|
| æ¸¸æˆåŸºç¡€ä¿¡æ¯ | 3600ç§’ (1å°æ—¶) | å˜åŒ–é¢‘ç‡ä½ |
| äº‹ä»¶åˆ—è¡¨ | 1800ç§’ (30åˆ†é’Ÿ) | ä¸­ç­‰å˜åŒ–é¢‘ç‡ |
| å‚æ•°é…ç½® | 7200ç§’ (2å°æ—¶) | å¾ˆå°‘å˜åŒ– |
| å®æ—¶ç»Ÿè®¡ | 60ç§’ (1åˆ†é’Ÿ) | æ¥è¿‘å®æ—¶ |
| ç”¨æˆ·ä¼šè¯ | 600ç§’ (10åˆ†é’Ÿ) | å¹³è¡¡æ€§èƒ½å’Œå®‰å…¨ |

**å…¬å¼å‚è€ƒ**:
```
TTL = æ•°æ®æ›´æ–°é¢‘ç‡ Ã— 0.1
ä¾‹å¦‚: æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡ â†’ TTL = 3600ç§’ Ã— 0.1 = 360ç§’
```

---

## ğŸŸ¡ æ€§èƒ½é—®é¢˜

### Q4: ç¼“å­˜å‘½ä¸­ç‡ä½æ€ä¹ˆåŠï¼Ÿ

**ç—‡çŠ¶**: å‘½ä¸­ç‡ < 70%

**è¯Šæ–­æ­¥éª¤**:
```bash
# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
curl http://127.0.0.1:5001/api/cache/stats

{
  "hits": 230,
  "misses": 1450,
  "hit_rate": 0.137  # å‘½ä¸­ç‡ä»…13.7%
}
```

**å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆ**:

1. **TTLè¿‡çŸ­** - ç¼“å­˜é¢‘ç¹è¿‡æœŸ
   - è§£å†³: å¢åŠ TTLå€¼
   ```python
   @cached(ttl=3600)  # ä»60ç§’å¢åŠ åˆ°3600ç§’
   ```

2. **ç¼“å­˜é”®å†²çª** - ä¸åŒæ•°æ®ä½¿ç”¨ç›¸åŒé”®
   - è§£å†³: ä½¿ç”¨æ›´å…·ä½“çš„é”®
   ```python
   # âŒ é”™è¯¯: ç¼“å­˜é”®å¯èƒ½å†²çª
   @cached(ttl=3600)
   def get_events(game_gid):
       pass

   # âœ… æ­£ç¡®: ä½¿ç”¨key_prefixé¿å…å†²çª
   @cached(ttl=3600, key_prefix="events:game")
   def get_events(game_gid):
       pass
   ```

3. **å†·å¯åŠ¨** - ç¼“å­˜åˆšå¯åŠ¨ï¼Œè¿˜æ²¡æœ‰æ•°æ®
   - è§£å†³: é¢„çƒ­ç¼“å­˜ï¼ˆå‚è§ [æ™ºèƒ½é¢„çƒ­](../development/developer-guide.md#æ™ºèƒ½é¢„çƒ­)ï¼‰

4. **ç¼“å­˜è¢«é¢‘ç¹æ¸…ç†** - æ•°æ®æ›´æ–°å¤ªé¢‘ç¹
   - è§£å†³: æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ›´æ–°æ“ä½œéƒ½éœ€è¦æ¸…ç†ç¼“å­˜

---

### Q5: Rediså†…å­˜å ç”¨è¿‡å¤§æ€ä¹ˆåŠï¼Ÿ

**ç—‡çŠ¶**: Rediså†…å­˜ä½¿ç”¨ > 80%

**è¯Šæ–­**:
```bash
# æŸ¥çœ‹Rediså†…å­˜ä½¿ç”¨
redis-cli INFO memory

# ç¤ºä¾‹è¾“å‡º:
used_memory: 2147483648  # 2GB
used_memory_peak: 3221225472  # å³°å€¼3GB
used_memory_percentage: 85.6%  # å†…å­˜ä½¿ç”¨ç‡85.6%
```

**è§£å†³æ–¹æ¡ˆ**:

1. **è®¾ç½®æœ€å¤§å†…å­˜**
   ```bash
   # redis.conf
   maxmemory 1gb
   maxmemory-policy allkeys-lru  # è‡ªåŠ¨æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„é”®
   ```

2. **å‡å°‘TTL** - ç¼©çŸ­ç¼“å­˜æ—¶é—´
   ```python
   @cached(ttl=600)  # ä»3600ç§’å‡å°‘åˆ°600ç§’
   ```

3. **æ¸…ç†å¤§å¯¹è±¡** - é¿å…ç¼“å­˜>1MBçš„å¯¹è±¡
   ```python
   # âŒ é”™è¯¯: ç¼“å­˜æ•´ä¸ªå¤§è¡¨
   @cached(ttl=3600)
   def get_all_logs():
       return fetch_all_as_dict('SELECT * FROM logs')  # å¯èƒ½æœ‰ç™¾ä¸‡è¡Œ

   # âœ… æ­£ç¡®: åˆ†é¡µç¼“å­˜
   @cached(ttl=600, key_prefix="logs:page")
   def get_logs_page(page: int, size: int = 100):
       return fetch_all_as_dict(
           'SELECT * FROM logs LIMIT ? OFFSET ?',
           (size, page * size)
       )
   ```

4. **ä½¿ç”¨æ•°æ®å‹ç¼©** (é«˜çº§)
   ```python
   import pickle
   import zlib

   compressed_data = zlib.compress(pickle.dumps(data))
   cache.set("key", compressed_data)
   ```

---

## ğŸ”´ æ•…éšœé—®é¢˜

### Q6: Redisè¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**ç—‡çŠ¶**: `Error connecting to Redis`

**è¯Šæ–­æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
redis-cli ping

# 2. æ£€æŸ¥Redisç«¯å£
netstat -an | grep 6379

# 3. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log | grep -i redis
```

**è§£å†³æ–¹æ¡ˆ**:

1. **å¯åŠ¨RedisæœåŠ¡**
   ```bash
   # macOS (Homebrew)
   brew services start redis

   # Linux
   sudo systemctl start redis

   # æ‰‹åŠ¨å¯åŠ¨
   redis-server /path/to/redis.conf
   ```

2. **æ£€æŸ¥è¿æ¥é…ç½®**
   ```python
   # backend/core/config/config.py
   REDIS_HOST = "127.0.0.1"  # æ£€æŸ¥åœ°å€
   REDIS_PORT = 6379  # æ£€æŸ¥ç«¯å£
   REDIS_DB = 0  # æ£€æŸ¥æ•°æ®åº“ç¼–å·
   ```

3. **å¯ç”¨ç¼“å­˜é™çº§** (æ¨è)
   ```python
   # Redisä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§åˆ°L1ç¼“å­˜
   from backend.core.cache.degradation import DegradationStrategy

   cache = DegradationStrategy()
   cache.set("key", value, ttl=3600)
   ```

---

### Q7: ç¼“å­˜æ•°æ®ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ

**ç—‡çŠ¶**: æ•°æ®åº“å·²æ›´æ–°ï¼Œä½†APIè¿”å›æ—§æ•°æ®

**æ ¹æœ¬åŸå› **: æ•°æ®æ›´æ–°åæœªæ¸…ç†ç¼“å­˜

**è§£å†³æ–¹æ¡ˆ**:

1. **ä½¿ç”¨ `@cache_invalidate` è£…é¥°å™¨** (æ¨è)
   ```python
   from backend.core.cache.decorators import cached, cache_invalidate

   @cached(ttl=3600)
   def get_events(game_gid):
       return fetch_all_as_dict('SELECT * FROM log_events')

   @cache_invalidate
   def update_event(event_id, data):
       # æ›´æ–°æ•°æ®åº“
       db.execute('UPDATE log_events SET ... WHERE id = ?', (event_id,))
       # è£…é¥°å™¨è‡ªåŠ¨æ¸…ç† get_events() ç›¸å…³çš„ç¼“å­˜
   ```

2. **æ‰‹åŠ¨æ¸…ç†ç¼“å­˜**
   ```python
   from backend.core.cache.cache_system import cache_result

   def update_event(event_id, data):
       db.execute('UPDATE log_events SET ...')
       # æ‰‹åŠ¨æ¸…ç†ç¼“å­˜
       cache_result.delete(f"events:{game_gid}")
   ```

3. **ä½¿ç”¨ç¼“å­˜Tags** (é«˜çº§)
   ```python
   # è®¾ç½®ç¼“å­˜æ—¶æ·»åŠ tag
   cache.set("events:10000147", data, tags=["games:10000147"])

   # æ¸…ç†æ‰€æœ‰ç›¸å…³ç¼“å­˜
   cache.delete_many(tags=["games:10000147"])
   ```

---

## ğŸ”§ é…ç½®é—®é¢˜

### Q8: å¦‚ä½•ç›‘æ§ç¼“å­˜æ€§èƒ½ï¼Ÿ

**æ–¹æ³•1: ä½¿ç”¨ç¼“å­˜API** (ç®€å•)
```bash
curl http://127.0.0.1:5001/api/cache/stats
```

**æ–¹æ³•2: Rediså†…ç½®ç›‘æ§** (è¯¦ç»†)
```bash
# å®æ—¶ç›‘æ§Rediså‘½ä»¤
redis-cli MONITOR

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
redis-cli SLOWLOG GET 10

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
redis-cli INFO stats
```

**æ–¹æ³•3: ä½¿ç”¨ç›‘æ§å·¥å…·** (æ¨è)
- **Redis Insight**: Rediså®˜æ–¹GUIå·¥å…·
- **Prometheus + Grafana**: ä¼ä¸šçº§ç›‘æ§æ–¹æ¡ˆ
- **Datadog**: SaaSç›‘æ§å¹³å°

---

### Q9: å¦‚ä½•åœ¨æµ‹è¯•ç¯å¢ƒç¦ç”¨ç¼“å­˜ï¼Ÿ

**æ–¹æ³•1: è®¾ç½®ç¯å¢ƒå˜é‡**
```bash
# .env (æµ‹è¯•ç¯å¢ƒ)
FLASK_ENV=testing
CACHE_ENABLED=false
```

**æ–¹æ³•2: ä½¿ç”¨æµ‹è¯•é…ç½®**
```python
# backend/core/config/config.py
if os.environ.get("FLASK_ENV") == "testing":
    CACHE_ENABLED = False
```

**æ–¹æ³•3: ä¸´æ—¶è®¾ç½®TTL=0**
```python
@cached(ttl=0)  # ç¼“å­˜ç«‹å³è¿‡æœŸ
def get_events(game_gid):
    pass
```

---

### Q10: ç¼“å­˜ç³»ç»Ÿä¼šå½±å“éƒ¨ç½²å—ï¼Ÿ

**å½±å“æ¸…å•**:

| ç»„ä»¶ | ä¾èµ– | éƒ¨ç½²è¦æ±‚ |
|------|------|---------|
| **Redis** | ç¼“å­˜å­˜å‚¨ | éœ€è¦å•ç‹¬éƒ¨ç½²RedisæœåŠ¡ |
| **L1ç¼“å­˜** | Pythonè¿›ç¨‹å†…å­˜ | æ— é¢å¤–è¦æ±‚ |
| **ç›‘æ§** | Redis | å¯é€‰ï¼Œç”¨äºæ€§èƒ½ç›‘æ§ |

**éƒ¨ç½²æ£€æŸ¥æ¸…å•**:
- [ ] RedisæœåŠ¡å·²å¯åŠ¨
- [ ] Redisé…ç½®æ­£ç¡®ï¼ˆhost, port, passwordï¼‰
- [ ] åº”ç”¨æœ‰è¶³å¤Ÿå†…å­˜ï¼ˆL1ç¼“å­˜ï¼‰
- [ ] ç›‘æ§å‘Šè­¦å·²é…ç½®

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**:
- Redisä½¿ç”¨æŒä¹…åŒ–ï¼ˆRDB + AOFï¼‰
- Redisä½¿ç”¨ä¸»ä»å¤åˆ¶
- ç›‘æ§Rediså†…å­˜ä½¿ç”¨ç‡
- è®¾ç½®Redisæœ€å¤§å†…å­˜é™åˆ¶

è¯¦ç»†é…ç½®å‚è§: [éƒ¨ç½²è¿ç»´æ–‡æ¡£](../operations/deployment.md)

---

## éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ

- **ğŸ“– [å®Œæ•´æ•…éšœæ’é™¤æ‰‹å†Œ](../operations/troubleshooting.md)** - è¯¦ç»†çš„é—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ
- **ğŸ‘¨â€ğŸ’» [å¼€å‘è€…æŒ‡å—](../development/developer-guide.md)** - é«˜çº§åŠŸèƒ½å’Œæœ€ä½³å®è·µ
- **ğŸš€ [éƒ¨ç½²è¿ç»´æ–‡æ¡£](../operations/deployment.md)** - ç”Ÿäº§ç¯å¢ƒé…ç½®æŒ‡å—

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-02-25
**ç›¸å…³æ–‡æ¡£**: [å¿«é€Ÿå¼€å§‹](./5-minute-guide.md) | [æ•…éšœæ’é™¤](../operations/troubleshooting.md) | [å¼€å‘è€…æŒ‡å—](../development/developer-guide.md)
