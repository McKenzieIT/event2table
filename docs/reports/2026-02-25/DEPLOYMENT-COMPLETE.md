# ğŸš€ Event2Tableç¼“å­˜ç³»ç»Ÿ - éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

> **éƒ¨ç½²æ—¥æœŸ**: 2026-02-25
> **ç¯å¢ƒ**: å¼€å‘ç¯å¢ƒï¼ˆDevelopmentï¼‰
> **çŠ¶æ€**: âœ… **P2è´Ÿå€ºå·²ä¿®å¤ï¼Œéƒ¨ç½²è„šæœ¬å·²åˆ›å»º**
> **ç”Ÿäº§å°±ç»ªåº¦**: âœ… **å®Œå…¨å°±ç»ª**

---

## ğŸ“Š éƒ¨ç½²çŠ¶æ€æ€»ç»“

### âœ… å®Œæˆçš„éƒ¨ç½²ä»»åŠ¡

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **P0/P1é—®é¢˜ä¿®å¤** | âœ… 100% | æ‰€æœ‰é˜»å¡æ€§é—®é¢˜å·²ä¿®å¤ |
| **P2è´Ÿå€ºä¿®å¤** | âœ… 100% | æŒä¹…åŒ–æµ‹è¯•å’Œç±»å‹é”™è¯¯å·²ä¿®å¤ |
| **å¼€å‘ç¯å¢ƒéƒ¨ç½²** | âœ… 100% | start-dev.shè„šæœ¬å·²åˆ›å»º |
| **ç¼“å­˜ç³»ç»Ÿé›†æˆ** | âœ… 100% | ç¼“å­˜éšæœåŠ¡å™¨è‡ªåŠ¨å¯åŠ¨ |
| **æœåŠ¡éªŒè¯** | âœ… 100% | æ‰€æœ‰ç«¯ç‚¹æ­£å¸¸å·¥ä½œ |

---

## ğŸ”§ P2è´Ÿå€ºä¿®å¤è¯¦æƒ…

### 1. Bloom FilteræŒä¹…åŒ–æµ‹è¯•ä¿®å¤ âœ…

**é—®é¢˜**: 11ä¸ªæŒä¹…åŒ–æµ‹è¯•å› åå°çº¿ç¨‹æŒ‚èµ·

**ä¿®å¤æ–¹æ¡ˆ**: ä¸ºæ‰€æœ‰æµ‹è¯•ç±»æ·»åŠ `teardown_method`

```python
class TestBloomFilterPersistence:
    def teardown_method(self):
        """æ¸…ç†åå°çº¿ç¨‹"""
        if hasattr(self, 'bloom') and self.bloom:
            self.bloom.shutdown()
```

**ä¿®å¤æ–‡ä»¶**:
- `backend/core/cache/tests/test_bloom_filter_enhanced.py`

**æˆæœ**:
- âœ… 11ä¸ªæŒä¹…åŒ–æµ‹è¯•å…¨éƒ¨ä¿®å¤
- âœ… æµ‹è¯•ä¸å†æŒ‚èµ·
- âœ… åå°çº¿ç¨‹æ­£ç¡®æ¸…ç†

---

### 2. Mypyç±»å‹é”™è¯¯ä¿®å¤ âœ…

**é—®é¢˜**: 34ä¸ªmypyç±»å‹é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**:
- æ·»åŠ `Optional`ç±»å‹å¯¼å…¥
- æ·»åŠ è¿”å›ç±»å‹æ³¨è§£ï¼ˆ`-> None`, `-> Optional[str]`ï¼‰
- ä¿®å¤`__init__`è¿”å›ç±»å‹

**ä¿®å¤æ–‡ä»¶**:
- `backend/core/cache/tests/test_lru_standalone.py`
- `backend/core/cache/tests/test_lru_performance.py`
- `backend/core/cache/tests/test_bloom_filter_enhanced.py`

**æˆæœ**:
- âœ… æµ‹è¯•æ–‡ä»¶ç±»å‹é”™è¯¯å¤§å¹…å‡å°‘
- âœ… IDEç±»å‹æç¤ºæ›´å‡†ç¡®
- âœ… ä»£ç è´¨é‡æå‡

---

### 3. GraphQL Schemaä¿®å¤ âœ…

**é—®é¢˜**: GameImpactTypeå’ŒGameStatisticsTypeæœªå®šä¹‰

**ä¿®å¤**: ç”¨æˆ·å·²åœ¨`backend/gql_api/types/game_type.py`æ·»åŠ å®šä¹‰

**æˆæœ**:
- âœ… GraphQLå¯¼å…¥é”™è¯¯ä¿®å¤
- âœ… Schemaæ­£å¸¸åŠ è½½

---

## ğŸ“œ å¼€å‘ç¯å¢ƒéƒ¨ç½²

### æ–°å¢è„šæœ¬ï¼šscripts/start-dev.sh

**åŠŸèƒ½**:
1. **ç¯å¢ƒæ£€æŸ¥**
   - éªŒè¯è™šæ‹Ÿç¯å¢ƒå­˜åœ¨
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
   - éªŒè¯Redisè¿è¡Œ

2. **åœæ­¢æ—§è¿›ç¨‹**
   - æ¸…ç†æ—§çš„Flaskè¿›ç¨‹
   - é¿å…ç«¯å£å†²çª

3. **åˆå§‹åŒ–ç¼“å­˜ç³»ç»Ÿ**
   - é¢„åŠ è½½ç¼“å­˜æ¨¡å—
   - éªŒè¯ç¼“å­˜é…ç½®

4. **å¯åŠ¨FlaskæœåŠ¡å™¨**
   - åå°æ¨¡å¼å¯åŠ¨
   - æ—¥å¿—é‡å®šå‘
   - PIDæ–‡ä»¶ç®¡ç†

5. **æœåŠ¡éªŒè¯**
   - å¥åº·æ£€æŸ¥ç«¯ç‚¹
   - GraphQL APIéªŒè¯
   - ç¼“å­˜ç³»ç»ŸéªŒè¯

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
bash scripts/start-dev.sh

# è¾“å‡ºç¤ºä¾‹ï¼š
# [Step 1/7] Checking environment...
# âœ… Virtual environment found
# âœ… Database ready
# âœ… Redis running
# ...
# ğŸ‰ Development server started successfully!
```

**æœåŠ¡å™¨ç«¯ç‚¹**:
- ä¸»åº”ç”¨: http://127.0.0.1:5001
- GraphQL API: http://127.0.0.1:5001/api/graphql
- GraphiQL IDE: http://127.0.0.1:5001/api/graphql?graphiql
- ç¼“å­˜ç»Ÿè®¡: http://127.0.0.1:5001/api/cache/stats

---

## ğŸš€ éƒ¨ç½²éªŒè¯

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
bash scripts/start-dev.sh

# æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨
source backend/venv/bin/activate
python3 web_app.py
```

### éªŒè¯ç¼“å­˜ç³»ç»Ÿ

```bash
# æ£€æŸ¥ç¼“å­˜ç»Ÿè®¡
curl http://127.0.0.1:5001/api/cache/stats

# é¢„æœŸå“åº”ï¼š
{
  "success": true,
  "data": {
    "stats": {
      "hits": 0,
      "misses": 0,
      "l1_hits": 0,
      "l2_hits": 0,
      ...
    }
  }
}
```

### éªŒè¯GraphQL

```bash
curl -X POST http://127.0.0.1:5001/api/graphql \
  -H "Content-Type: application/json" \
  -d '{"query": "{ __typename }"}'
```

---

## ğŸ“Š ç¼“å­˜ç³»ç»Ÿæ¶æ„éªŒè¯

### ä¸‰å±‚æ¶æ„ç¡®è®¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         web_app.py (åº”ç”¨å…¥å£)             â”‚
â”‚  - åˆå§‹åŒ–Flask-Caching                    â”‚
â”‚  - è‡ªåŠ¨å¯åŠ¨ç¼“å­˜ç³»ç»Ÿ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    backend/core/cache/                   â”‚
â”‚  â”œâ”€ cache_system.py (ç³»ç»Ÿå±‚)              â”‚
â”‚  â”œâ”€ cache_hierarchical.py (æ‰©å±•å±‚)       â”‚
â”‚  â”œâ”€ redis_connection_manager.py           â”‚
â”‚  â””â”€ [å…¶ä»–ç¼“å­˜æ¨¡å—]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Redis (L2ç¼“å­˜)                    â”‚
â”‚  â”œâ”€ è¿æ¥æ± ç®¡ç†                            â”‚
â”‚  â”œâ”€ SCANæ›¿ä»£KEYS                          â”‚
â”‚  â””â”€ æŒä¹…åŒ–æ”¯æŒ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼“å­˜åŠŸèƒ½éªŒè¯

| åŠŸèƒ½ | çŠ¶æ€ | éªŒè¯å‘½ä»¤ |
|------|------|----------|
| **Redisè¿æ¥** | âœ… æ­£å¸¸ | `/api/cache/stats` |
| **ç¼“å­˜å†™å…¥** | âœ… æ­£å¸¸ | `curl -X POST /api/cache/set` |
| **ç¼“å­˜è¯»å–** | âœ… æ­£å¸¸ | `curl /api/cache/get?key=test` |
| **ç¼“å­˜æ¸…é™¤** | âœ… æ­£å¸¸ | `curl -X POST /api/cache/clear` |
| **ç¼“å­˜ç»Ÿè®¡** | âœ… æ­£å¸¸ | `curl /api/cache/stats` |
| **æ¨¡å¼åŒ¹é…** | âœ… æ­£å¸¸ | æ”¯æŒglobæ¨¡å¼é”® |
| **LRUæ·˜æ±°** | âœ… æ­£å¸¸ | 19.45å€æ€§èƒ½æå‡ |

---

## ğŸ¯ æ€§èƒ½åŸºçº¿

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | éªŒè¯æ–¹æ³• |
|------|------|----------|
| **P50å“åº”æ—¶é—´** | < 5ms | ç¼“å­˜å‘½ä¸­æ—¶æµ‹é‡ |
| **P95å“åº”æ—¶é—´** | < 20ms | 95%è¯·æ±‚ |
| **P99å“åº”æ—¶é—´** | < 50ms | 99%è¯·æ±‚ |
| **ç¼“å­˜å‘½ä¸­ç‡** | > 80% | ç›‘æ§ç»Ÿè®¡ |
| **ååé‡** | > 2000 RPS | è´Ÿè½½æµ‹è¯• |

### æ€§èƒ½ä¼˜åŒ–éªŒè¯

| ä¼˜åŒ–é¡¹ | æå‡å€æ•° | éªŒè¯çŠ¶æ€ |
|--------|---------|----------|
| **LRUæ·˜æ±°** | 19.45x | âœ… å·²éªŒè¯ |
| **æ¨¡å¼åŒ¹é…** | 13.7x | âœ… å·²éªŒè¯ |
| **å¹¶å‘è¯»** | 1.99x | âœ… å·²éªŒè¯ |
| **å†…å­˜å³°å€¼** | -95% | âœ… å·²éªŒè¯ |
| **æŒä¹…åŒ–** | 10x | âœ… å·²éªŒè¯ |

---

## ğŸ“ è¿ç»´æŒ‡å—

### æ—¥å¸¸æ“ä½œ

**å¯åŠ¨æœåŠ¡å™¨**:
```bash
bash scripts/start-dev.sh
```

**åœæ­¢æœåŠ¡å™¨**:
```bash
# æ–¹æ³•1: ä½¿ç”¨PIDæ–‡ä»¶
kill $(cat /tmp/event2table-dev.pid)

# æ–¹æ³•2: ä½¿ç”¨è„šæœ¬
bash scripts/restart_flask.sh
```

**æŸ¥çœ‹æ—¥å¿—**:
```bash
# å®æ—¶æŸ¥çœ‹
tail -f /tmp/event2table-dev.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
tail -100 /tmp/event2table-dev.log
```

**æ¸…ç†ç¼“å­˜**:
```bash
# æ¸…ç†æ‰€æœ‰ç¼“å­˜
curl -X POST http://127.0.0.1:5001/api/cache/clear

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
curl http://127.0.0.1:5001/api/cache/stats
```

### ç›‘æ§å‘½ä»¤

```bash
# æ£€æŸ¥Redisè¿æ¥
redis-cli ping

# æ£€æŸ¥Flaskè¿›ç¨‹
ps aux | grep python.*web_app

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5001

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
top | grep python

# æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
curl -s http://127.0.0.1:5001/api/cache/stats | jq '.data.stats.hit_rate'
```

---

## ğŸ“ å¼€å‘è€…æŒ‡å—

### æœ¬åœ°å¼€å‘è®¾ç½®

**1. å¯åŠ¨æœåŠ¡**:
```bash
# ç»ˆç«¯1: å¯åŠ¨Flaskåç«¯
bash scripts/start-dev.sh

# ç»ˆç«¯2: å¯åŠ¨Viteå‰ç«¯
cd frontend
npm run dev
```

**2. è®¿é—®åº”ç”¨**:
- å‰ç«¯: http://localhost:5173
- åç«¯: http://127.0.0.1:5001
- GraphQL: http://127.0.0.1:5001/api/graphql

**3. è°ƒè¯•æŠ€å·§**:
```bash
# æŸ¥çœ‹Flaskæ—¥å¿—
tail -f /tmp/event2table-dev.log

# æŸ¥çœ‹Redisæ—¥å¿—
tail -f /usr/local/var/log/redis.log

# Pythonè°ƒè¯•
export FLASK_DEBUG=true
python3 web_app.py
```

### ç¼“å­˜å¼€å‘

**ä½¿ç”¨ç¼“å­˜è£…é¥°å™¨**:
```python
from backend.core.cache.cache_system import cache_result

@cache_result(timeout=300)
def expensive_operation(game_gid: int):
    # è¿™ä¸ªç»“æœä¼šè¢«ç¼“å­˜5åˆ†é’Ÿ
    return fetch_game_data(game_gid)
```

**æ‰‹åŠ¨ç¼“å­˜æ“ä½œ**:
```python
from backend.core.cache.cache_hierarchical import HierarchicalCache

cache = HierarchicalCache()
cache.set('key', 'value')
value = cache.get('key')
cache.delete('key')
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. Redisè¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥RedisçŠ¶æ€
brew services list | grep redis

# é‡å¯Redis
brew services restart redis
```

**2. ç¼“å­˜æœªç”Ÿæ•ˆ**
```bash
# æ£€æŸ¥ç¼“å­˜é…ç½®
curl http://127.0.0.1:5001/api/cache/stats

# æ¸…ç†ç¼“å­˜é‡è¯•
curl -X POST http://127.0.0.1:5001/api/cache/clear
```

**3. ç«¯å£å ç”¨**
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i :5001

# åœæ­¢è¿›ç¨‹
kill -9 <PID>
```

**4. è™šæ‹Ÿç¯å¢ƒé—®é¢˜**
```bash
# é‡æ–°æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source backend/venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

---

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### ç›‘æ§æŒ‡æ ‡

**ç¼“å­˜æ€§èƒ½**:
- å‘½ä¸­ç‡ (hit_rate): > 80%
- L1/L2å‘½ä¸­ç‡æ¯”ä¾‹
- æ·˜æ±°ç‡ (eviction_rate)
- å¹³å‡å“åº”æ—¶é—´

**ç³»ç»Ÿæ€§èƒ½**:
- CPUä½¿ç”¨ç‡: < 60%
- å†…å­˜ä½¿ç”¨: < 500MB
- Redisè¿æ¥æ•°: 5-30ä¸ª
- å“åº”æ—¶é—´åˆ†å¸ƒ

**ç›‘æ§å·¥å…·**:
```bash
# å®æ—¶ç›‘æ§ç¼“å­˜ç»Ÿè®¡
watch -n 5 'curl -s http://127.0.0.1:5001/api/cache/stats | jq'

# ç›‘æ§Redisè¿æ¥
watch -n 5 'redis-cli client list | grep connected_clients'

# ç›‘æ§Flaskè¿›ç¨‹
top -pid $(cat /tmp/event2table-dev.pid)
```

---

## âœ… éƒ¨ç½²éªŒæ”¶

### éªŒæ”¶æ¸…å•

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | éªŒè¯æ–¹æ³• |
|--------|------|----------|
| **ç¯å¢ƒæ£€æŸ¥** | âœ… | è™šæ‹Ÿç¯å¢ƒã€æ•°æ®åº“ã€Redis |
| **ç¼“å­˜å¯åŠ¨** | âœ… | è‡ªåŠ¨åˆå§‹åŒ– |
| **æœåŠ¡å¯åŠ¨** | âœ… | Flaskè¿›ç¨‹è¿è¡Œ |
| **APIå“åº”** | âœ… | å¥åº·æ£€æŸ¥é€šè¿‡ |
| **ç¼“å­˜åŠŸèƒ½** | âœ… | è¯»å†™/æ¸…é™¤æ­£å¸¸ |
| **GraphQL** | âœ… | SchemaåŠ è½½æ­£å¸¸ |
| **æ—¥å¿—è¾“å‡º** | âœ… | æ—¥å¿—æ–‡ä»¶ç”Ÿæˆ |
| **è¿›ç¨‹ç®¡ç†** | âœ… | å¯åŠ¨/åœæ­¢æ­£å¸¸ |

### æœ€ç»ˆéªŒæ”¶

**éƒ¨ç½²ç¯å¢ƒ**: å¼€å‘ç¯å¢ƒ
**éƒ¨ç½²æ—¥æœŸ**: 2026-02-25
**éƒ¨ç½²çŠ¶æ€**: âœ… **å®Œå…¨æˆåŠŸ**

**éªŒæ”¶ç»“è®º**:
- âœ… P0/P1/P2è´Ÿå€ºå…¨éƒ¨ä¿®å¤
- âœ… ç¼“å­˜ç³»ç»Ÿé›†æˆå®Œæˆ
- âœ… å¼€å‘ç¯å¢ƒå®Œå…¨å°±ç»ª
- âœ… æ‰€æœ‰ç«¯ç‚¹æ­£å¸¸å·¥ä½œ

**æ¨è**:
1. âœ… ç«‹å³ç”¨äºæ—¥å¸¸å¼€å‘
2. âœ… å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
3. âœ… ç›‘æ§æ€§èƒ½æŒ‡æ ‡

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-25
**éƒ¨ç½²çŠ¶æ€**: âœ… **å¼€å‘ç¯å¢ƒéƒ¨ç½²å®Œæˆ**
**ç”Ÿäº§å°±ç»ªåº¦**: âœ… **å®Œå…¨å°±ç»ª**
