import { test, expect } from '@playwright/test';

test('Wait test - check React app loads', async ({ page }) => {
  // 设置游戏数据
  await page.goto('/react-app-shell/#/');
  await page.evaluate(() => {
    localStorage.setItem('selectedGameGid', '10000147');
    (window as any).gameData = {
      id: 16,
      gid: '10000147',
      name: '游戏 10000147',
      ods_db: 'ieu_ods',
    };
  });

  // 访问事件节点构建器页面
  await page.goto('/react-app-shell/#/event-node-builder?game_gid=10000147');

  // Wait specifically for React app to mount
  await page.waitForSelector('#app-root', { timeout: 10000 });
  console.log('✓ Found #app-root');

  // Wait a bit more for React to render
  await page.waitForTimeout(5000);

  // Check what's inside app-root
  const appRootContent = await page.locator('#app-root').innerHTML();
  console.log('app-root content length:', appRootContent.length);

  // Check for EventNodeBuilder
  const eventNodeBuilder = await page.locator('#app-root .event-node-builder').count();
  console.log('event-node-builder count:', eventNodeBuilder);

  // Check for loading state
  const loading = await page.locator('#app-root .event-node-builder-loading').count();
  console.log('loading count:', loading);

  // Take screenshot
  await page.screenshot({ path: 'wait-test.png', fullPage: true });
});
