# ⚠️ STAR001 游戏保护规则

> **创建日期**: 2026-02-17
> **更新日期**: 2026-02-17
> **重要等级**: 🔴 **CRITICAL**

---

## 🎯 游戏信息

| 属性 | 值 |
|------|-----|
| **GID** | 10000147 |
| **名称** | STAR001 |
| **ODS_DB** | ieu_ods |
| **用途** | 开发测试主要游戏，包含核心测试数据 |

---

## 🚨 保护规则

### **严禁删除**

**绝对禁止以下操作**：
- ❌ 删除STAR001游戏记录
- ❌ 删除STAR001关联的事件
- ❌ 删除STAR001关联的参数
- ❌ 删除STAR001关联的节点配置
- ❌ 任何会导致数据丢失的测试操作

**原因**：
1. STAR001是项目的主要测试游戏
2. 包含核心测试数据（事件、参数配置）
3. 多个功能依赖此游戏进行测试
4. 历史上已发生过数据丢失事故（2026-02-17）

---

## 📊 当前数据状态

| 数据类型 | 数量 | 说明 |
|---------|------|------|
| **事件** | 22 | 包括核心事件（zm_pvp_*, login, role.online等） |
| **参数** | 20 | 每个事件的关键参数 |
| **节点配置** | 0 | 可根据需要添加 |

---

## 🛡️ 测试规则

### **使用专用测试游戏GID**

所有测试操作必须使用 **90000000+** 范围的GID：

```python
# ✅ 正确：使用测试GID
TEST_GAME_GID_START = 90000000
TEST_GAME_GID_END = 99999999

# 示例
test_gid_1 = 90000001
test_gid_2 = 90000002
test_gid_batch = list(range(90000100, 90000100 + 100))
```

```javascript
// ✅ 正确：前端测试
const TEST_GIDS = [90000001, 90000002, 90000003];
```

### **禁止的操作**

```python
# ❌ 错误：使用STAR001进行破坏性测试
game_gid = 10000147  # STAR001 - 禁止删除！

# ❌ 错误：批量删除包含STAR001
games_to_delete = [10000147, 90000001, 90000002]  # 包含STAR001！
```

### **正确的测试流程**

```python
# ✅ 正确：创建专用测试游戏
test_game = create_game(
    gid=90000001,  # 测试GID
    name="Test Game for Batch Delete",
    ods_db="ieu_ods"
)

# ✅ 正确：测试完成后清理
delete_game(90000001)  # 只删除测试游戏
```

---

## 🔄 数据恢复

### **可用恢复脚本**

项目提供了以下脚本用于恢复/生成测试数据：

1. **创建测试事件**
   ```bash
   python3 scripts/manual/create_test_events.py
   ```

2. **创建测试参数**
   ```bash
   python3 scripts/manual/create_test_params.py
   ```

3. **创建角色上线事件**
   ```bash
   python3 scripts/manual/create_role_online_event.py
   ```

### **数据备份**

**自动备份位置**：
- `data/dwd_generator.db.backup_20260211` (2026-02-11快照)

**建议**：
- 每周手动备份一次数据库
- 重大修改前创建快照
- 使用版本控制跟踪数据变更

---

## 📋 测试前检查清单

在执行任何删除操作前，必须确认：

- [ ] 使用的游戏GID在 90000000+ 范围
- [ ] 不包含GID 10000147 (STAR001)
- [ ] 不包含任何生产数据的GID
- [ ] 已备份数据库（可选但推荐）

---

## 🚨 事故记录

### **2026-02-17 数据丢失事故**

**事故描述**：在测试批量删除功能时，错误地删除了STAR001游戏及其关联数据

**丢失数据**：
- 事件：1903 → 22 (丢失 1881 个，99.0%)
- 参数：36707 → 20 (丢失 36687 个，99.9%)

**原因**：
1. 测试代码使用了真实的STAR001 GID
2. 级联删除导致所有关联数据被清除
3. 测试前未检查游戏GID范围

**恢复措施**：
1. ✅ 从opencode test项目备份恢复完整数据（1903事件，36707参数）
   - 备份位置：`/Users/mckenzie/Documents/opencode test/dwd_generator/data/db/backups/dwd_generator.db`
   - 恢复日期：2026-02-17
2. ✅ 创建本保护文档防止再次发生
3. ✅ 建立测试GID规范（90000000+）
4. ✅ 更新CLAUDE.md开发规范

**恢复后数据状态**：
- ✅ 事件：1903 (100%恢复)
- ✅ 参数：36707 (100%恢复)
- ✅ 事件类型：1903种唯一事件

**教训**：
- ✅ 永久使用专用测试GID
- ✅ 测试前必须检查GID范围
- ✅ 破坏性测试必须有数据备份
- ✅ 从opencode test项目备份成功恢复完整数据

---

## 📖 相关文档

- [CLAUDE.md](../CLAUDE.md) - 项目开发规范
- [开发规范 - 游戏标识符规范](../CLAUDE.md#游戏标识符规范--重要)
- [测试规范](../testing/README.md) - 测试相关规范

---

## ✅ 承诺

作为开发者，我承诺：

1. **永远不删除** GID 10000147 (STAR001) 的任何数据
2. **永远使用** 90000000+ 范围的GID进行测试
3. **测试前检查** 确认不包含生产数据
4. **重大操作前备份** 数据库

---

**文档维护者**: Event2Table Development Team
**最后更新**: 2026-02-17
**版本**: 1.0
