# EventNodeBuilder 紧凑模式测试指南

**日期**: 2026-02-18
**状态**: ✅ 实现完成，等待测试
**前端服务器**: http://localhost:5173

---

## 🎯 测试目标

验证两个优化是否成功：
1. ✅ **控制台错误修复** - 初始加载时不显示 `[HQLPreviewContainer] Missing or invalid event` 错误
2. ✅ **紧凑模式** - 字段项高度减少40%，所有元素水平对齐

---

## 📋 测试步骤

### Step 1: 打开浏览器开发者工具

1. 打开 Chrome 浏览器
2. 按 `F12` 或 `Cmd+Option+I` (Mac) 打开开发者工具
3. 切换到 **Console** 面板
4. 点击 "Clear console" 按钮清空控制台

### Step 2: 导航到 EventNodeBuilder

1. 在浏览器地址栏输入:
   ```
   http://localhost:5173/#/event-node-builder?game_gid=10000147
   ```

2. **验证控制台无错误**:
   - ✅ 控制台应该**不显示** `[HQLPreviewContainer] Missing or invalid event` 错误
   - ✅ 可能只有其他警告（如 React Router warnings），但没有我们修复的错误

### Step 3: 选择事件

1. 在事件列表中找到并点击: `zm_pvp-观看初始分数界面 (zmpvp.vis)`
2. 观察参数字段区域 - 应该显示35个参数

### Step 4: 测试紧凑模式 - 添加基础字段

1. 双击基础字段区域的 `role_id (角色ID)`
2. **观察字段画布中的新字段项**:

   ✅ **预期效果**:
   ```
   ┌─────────────────────────────────────┐
   │[⋮⋮][基础] role_id (role_id) [STRING] [编辑][删除]│
   └─────────────────────────────────────┘
   ↑ 高度约 48px（紧凑）
   ```

   **验证点**:
   - ✅ 字段项高度约为 48px（原~80px，减少40%）
   - ✅ 所有元素在同一水平线上:
     - [⋮⋮] 拖拽手柄
     - [基础] 类型标签
     - role_id 字段别名
     - (role_id) 原始名称
     - [STRING] 数据类型
     - [编辑][删除] 操作按钮
   - ✅ 悬停时显示Cyan边框和发光效果

### Step 5: 测试紧凑模式 - 添加参数字段

1. 双击参数字段区域的 `角色id roleId`
2. **观察第二个字段项**:
   - ✅ 高度一致（48px）
   - ✅ 水平对齐正确
   - ✅ 类型标签显示 "参数"

### Step 6: 测试拖拽功能

1. 点击并拖拽第一个字段（role_id）的拖拽手柄 [⋮⋮]
2. 将其拖动到第二个字段下方
3. **验证**:
   - ✅ 拖拽过程流畅
   - ✅ 拖拽时显示半透明效果
   - ✅ 释放后字段重新排序
   - ✅ 高度和对齐保持不变

### Step 7: 测试编辑/删除功能

1. 点击第一个字段的 "编辑" 按钮
   - ✅ 应该打开编辑模态框
   - ✅ 点击 "取消" 关闭

2. 点击第二个字段的 "删除" 按钮
   - ✅ 应该显示确认对话框
   - ✅ 点击 "取消" 关闭对话框

### Step 8: 测试多字段场景

1. 继续添加字段，总共添加 10-15 个字段
2. **验证**:
   - ✅ 每个字段高度一致（48px）
   - ✅ 所有字段对齐完美
   - ✅ 可以在不滚动的情况下看到更多字段（相比原来）
   - ✅ 滚动流畅，无卡顿

### Step 9: 测试悬停效果

1. 将鼠标悬停在任何字段项上
2. **验证**:
   - ✅ 背景色变亮（`rgba(255, 255, 255, 0.06)`）
   - ✅ 边框变成Cyan色（`rgba(6, 182, 212, 0.3)`）
   - ✅ 向上移动1px（`translateY(-1px)`）
   - ✅ 显示阴影（`0 2px 8px rgba(6, 182, 212, 0.15)`）

### Step 10: 测试 Tooltip（可选）

1. 将鼠标悬停在字段别名上
2. **验证**:
   - ✅ 鼠标指针变成帮助样式 (cursor: help)
   - ✅ 如果文字被截断，悬停显示完整字段名

---

## 🎨 视觉对比

### 修改前（标准模式 ~80px）:
```
┌────────────────────────────────────────────┐
│                                            │
│  [⋮⋮]                                     │
│                                            │
│        [基础]                               │
│                                            │
│        role_id (role_id)                    │
│                                            │
│        [STRING]                             │
│                                            │
│                           [编辑]      [删除] │
│                                            │
└────────────────────────────────────────────┘
   ↑ 大量垂直空间浪费
```

### 修改后（紧凑模式 48px）:
```
┌────────────────────────────────────────┐
│[⋮⋮][基础] role_id (role_id) [STR][编辑][×]│
└────────────────────────────────────────┘
   ↑ 40%高度减少，完美对齐
```

---

## ✅ 成功指标

### 定量指标

| 指标 | 目标 | 实际 |
|------|------|------|
| 控制台错误 | 0 | ☐ 待验证 |
| 字段项高度 | 48px | ☐ 待验证 |
| 高度减少 | 40% | ☐ 待验证 |
| 水平对齐 | 完美 | ☐ 待验证 |
| 拖拽流畅度 | 流畅 | ☐ 待验证 |

### 定性指标

| 指标 | 状态 |
|------|------|
| Cyberpunk风格一致性 | ☐ 待验证 |
| 响应式适配 | ☐ 待验证（移动端） |
| 拖拽功能保持 | ☐ 待验证 |
| 编辑/删除功能 | ☐ 待验证 |

---

## 🐛 问题反馈

如果发现问题，请记录以下信息：

1. **问题描述**: [详细描述问题]
2. **重现步骤**:
   - 步骤1: ...
   - 步骤2: ...
3. **预期结果**: [应该发生什么]
4. **实际结果**: [实际发生了什么]
5. **截图**: [如果有可见问题]
6. **控制台错误**: [复制控制台错误信息]

---

## 📊 性能对比

### 字段显示容量

| 模式 | 字段高度 | 每屏显示（768px） | 提升 |
|------|---------|-----------------|------|
| 标准模式 | ~80px | ~9个字段 | - |
| 紧凑模式 | 48px | ~14个字段 | +55% |

### 滚动效率

假设有20个字段：
- **标准模式**: 需要滚动11次（80px × 20 = 1600px ÷ 768px ≈ 2.08屏）
- **紧凑模式**: 只需滚动1次（48px × 20 = 960px ÷ 768px ≈ 1.25屏）

**滚动次数减少**: 约50%

---

## 🎯 Cyberpunk 风格验证清单

- [ ] 背景色: `rgba(255, 255, 255, 0.03)` (极淡的玻璃效果)
- [ ] 边框: `rgba(255, 255, 255, 0.06)` (细边框)
- [ ] Hover边框: Cyan色 (`rgba(6, 182, 212, 0.3)`)
- [ ] Hover阴影: `0 2px 8px rgba(6, 182, 212, 0.15)` (发光效果)
- [ ] 字体:
  - [ ] 类型标签: 10px
  - [ ] 字段别名: 13px, 600 weight
  - [ ] 原始名称: 11px
  - [ ] 数据类型: 9px, monospace, uppercase
- [ ] 间距:
  - [ ] padding: 4px 8px
  - [ ] gap: 4px
  - [ ] min-height: 48px

---

## 📝 测试完成清单

测试完成后，请填写以下清单：

- [ ] Step 1: 控制台无错误
- [ ] Step 2: 导航到EventNodeBuilder成功
- [ ] Step 3: 事件选择成功
- [ ] Step 4: 基础字段添加正确
- [ ] Step 5: 参数字段添加正确
- [ ] Step 6: 拖拽功能正常
- [ ] Step 7: 编辑/删除功能正常
- [ ] Step 8: 多字段场景通过
- [ ] Step 9: 悬停效果正确
- [ ] Step 10: Tooltip工作正常

**总体评估**: ☐ 完全成功  ☐ 部分成功  ☐ 需要修复

---

## 🔧 如需切换回标准模式

如果需要对比标准模式和紧凑模式，可以修改：

**文件**: `frontend/src/event-builder/components/FieldCanvas.tsx`
**第220行**:
```tsx
// 紧凑模式（默认开启）
const [compactMode, setCompactMode] = useState(true);  // 改为 false 关闭
```

然后保存文件，Vite会自动热更新。

---

**测试完成后，请将结果反馈给我！** 🚀
