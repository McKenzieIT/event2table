# EventNodeBuilder UI Optimization Test Plan

**Date**: 2026-02-19
**Features**: P0-P2 全部实现完成
**Status**: 待测试

---

## 测试环境

**前端开发服务器**: http://localhost:5173
**测试页面**: `/event-node-builder?game_gid=10000147`

---

## 测试清单

### P0 功能测试

#### 1. ✅ CanvasStatsDisplay 纯显示组件

**预期行为**:
- [ ] 统计信息显示格式: "📊 累计 n 参数 n 基础 n"
- [ ] 无点击响应（不是按钮）
- [ ] 样式与 ⚡基础 0/7 组件一致
- [ ] 悬停无变化（无 cursor: pointer）

**测试步骤**:
1. 打开 EventNodeBuilder 页面
2. 查看画布左上角的统计信息
3. 点击统计信息
4. **预期**: 无任何响应

---

#### 2. ✅ EdgeToolbar 底部边缘激活栏

**预期行为**:
- [ ] 默认状态：工具栏隐藏在底部
- [ ] 鼠标悬停画布底部时，工具栏滑入
- [ ] 边缘有发光效果（4px → 8px）
- [ ] 工具栏包含：[基础] [自定义] [固定值] | [快速]
- [ ] 点击 [快速] 显示快速添加工具：[常用] [全部] + 7个基础字段按钮

**测试步骤**:
1. 打开 EventNodeBuilder 页面
2. 将鼠标移动到画布底部边缘
3. **预期**: 工具栏从底部滑入
4. **预期**: 底部边缘线变亮（4px → 8px）
5. 点击 [基础] 按钮
6. **预期**: 打开添加基础字段对话框
7. 点击 [快速] 按钮
8. **预期**: 显示 [常用] [全部] 和 7 个基础字段按钮
9. 点击 [常用] 按钮
10. **预期**: 自动添加 ds, role_id, account_id, tm 四个字段

---

#### 3. ✅ WHERE 条件默认展开

**预期行为**:
- [ ] 右侧边栏的 WHERE 条件构建器默认展开状态
- [ ] 可以看到现有的 WHERE 条件列表

**测试步骤**:
1. 打开 EventNodeBuilder 页面
2. 查看右侧边栏
3. **预期**: WHERE 条件区域默认展开，显示条件列表

---

### P1 功能测试

#### 4. ✅ FieldContextMenu 右键菜单

**预期行为**:
- [ ] 在画布区域右键点击，显示上下文菜单
- [ ] 菜单包含：
  - 📝 添加基础字段 (B)
  - 💻 添加自定义字段 (C)
  - 📌 添加固定值 (F)
  - ⚡ 快速添加常用字段 (Q)
- [ ] 点击菜单外部或按 ESC 关闭菜单
- [ ] 菜单项悬停有高亮效果

**测试步骤**:
1. 打开 EventNodeBuilder 页面
2. 在画布区域右键点击
3. **预期**: 显示上下文菜单
4. 点击菜单外部
5. **预期**: 菜单关闭
6. 再次右键点击，按 ESC
7. **预期**: 菜单关闭

---

#### 5. ✅ OnboardingGuide 首次引导

**预期行为**:
- [ ] 首次访问页面时，1秒后显示引导卡片
- [ ] 引导包含 4 条提示：
  1. 🖱️ 鼠标移至底部边缘，快速添加字段
  2. ⚡ 使用快速添加功能，一键添加常用字段
  3. 🖱️ 右键点击画布，打开快捷菜单
  4. ⌨️ 使用键盘快捷键，提升操作效率
- [ ] 点击 [我知道了]，标记为已读，不再显示
- [ ] 点击 [不再显示]，永久隐藏
- [ ] LocalStorage 存储：`event-builder-guide-seen`, `event-builder-guide-dismissed`

**测试步骤**:
1. 打开浏览器开发者工具 → Application → Local Storage
2. 删除 `event-builder-guide-seen` 和 `event-builder-guide-dismissed`
3. 刷新页面
4. **预期**: 1秒后显示引导卡片
5. 点击 [我知道了]
6. **预期**: 引导关闭
7. 刷新页面
8. **预期**: 引导不再显示
9. 重新删除 LocalStorage 项
10. 点击 [不再显示]
11. **预期**: 引导关闭，永久不再显示

---

### P2 功能测试

#### 6. ✅ KeyboardShortcuts 快捷键系统

**预期行为**:
- [ ] 按 `B` 键：打开添加基础字段对话框
- [ ] 按 `C` 键：打开添加自定义字段对话框
- [ ] 按 `F` 键：打开添加固定值对话框
- [ ] 按 `Q` 键：快速添加常用字段（ds, role_id, account_id, tm）
- [ ] 按 `A` 键：添加所有基础字段
- [ ] 按 `Del` 键：删除最后一个字段
- [ ] 按 `Esc` 键：关闭所有打开的对话框
- [ ] 按 `Ctrl+S` 键：保存配置
- [ ] 按 `W` 键：打开 WHERE 条件模态框
- [ ] 按 `H` 键：打开 HQL 预览模态框
- [ ] 按 `?` 键：显示快捷键帮助面板

**测试步骤**:
1. 打开 EventNodeBuilder 页面
2. 按 `B` 键
3. **预期**: 打开添加基础字段对话框
4. 按 `Esc` 键
5. **预期**: 对话框关闭
6. 按 `Q` 键
7. **预期**: 自动添加 4 个常用字段
8. 按 `Del` 键
9. **预期**: 删除最后一个字段
10. 按 `?` 键
11. **预期**: 显示快捷键帮助面板
12. 点击 [我知道了] 关闭帮助
13. 在输入框中输入文字，按 `B` 键
14. **预期**: 不触发快捷键（输入框中禁用）

---

#### 7. ✅ Advanced Animations 高级动画

**预期行为**:
- [ ] 边缘工具栏：平滑滑入/滑出动画
- [ ] 右键菜单：淡入 + 缩放动画
- [ ] 引导卡片：滑入 + 缩放动画
- [ ] 快捷键帮助：滑入 + 缩放动画
- [ ] 按钮悬停：微妙的高亮和阴影效果
- [ ] 字段项：添加时的淡入动画

**测试步骤**:
1. 打开 EventNodeBuilder 页面
2. 将鼠标移至底部边缘
3. **预期**: 工具栏平滑滑入（0.3s cubic-bezier）
4. 右键点击画布
5. **预期**: 菜单淡入 + 缩放（0.2s ease）
6. 首次访问（清除 LocalStorage）
7. **预期**: 引导卡片滑入 + 缩放（0.4s cubic-bezier）
8. 按 `?` 键
9. **预期**: 帮助面板滑入 + 缩放（0.4s cubic-bezier）
10. 悬停工具栏按钮
11. **预期**: 微妙的高亮和阴影变化

---

## 浏览器兼容性测试

**测试浏览器**:
- [ ] Chrome/Edge (Chromium)
- [ ] Firefox
- [ ] Safari

**测试要点**:
- [ ] 动画流畅度
- [ ] 键盘快捷键响应
- [ ] 右键菜单位置
- [ ] LocalStorage 功能

---

## 响应式测试

**测试屏幕尺寸**:
- [ ] 桌面 (1920x1080)
- [ ] 笔记本 (1366x768)
- [ ] 平板 (768x1024)
- [ ] 移动 (375x667)

**测试要点**:
- [ ] 边缘工具栏在小屏幕上的显示
- [ ] 引导卡片在小屏幕上的布局
- [ ] 快捷键帮助在小屏幕上的布局

---

## 性能测试

**测试要点**:
- [ ] 动画不卡顿（60fps）
- [ ] 快捷键响应延迟 < 50ms
- [ ] 工具栏滑入动画流畅
- [ ] 内存使用稳定

**测试工具**:
- Chrome DevTools → Performance
- Chrome DevTools → Rendering → Frame Rendering Stats

---

## 可访问性测试

**测试要点**:
- [ ] 键盘导航（Tab 键）
- [ ] 焦点可见性（focus-visible）
- [ ] ARIA 标签
- [ ] 减少动画模式（`prefers-reduced-motion`）

**测试步骤**:
1. 打开 Chrome DevTools → Rendering → Emulate media prefers-reduced-motion
2. **预期**: 所有动画和过渡效果被禁用

---

## 回归测试

**确保原有功能正常**:
- [ ] 拖拽添加字段正常
- [ ] 字段编辑正常
- [ ] 字段删除正常
- [ ] 字段重新排序正常
- [ ] WHERE 条件编辑正常
- [ ] HQL 预览生成正常
- [ ] 配置保存/加载正常

---

## 已知问题

**无**

---

## 测试结果

**测试人员**: __________
**测试日期**: __________
**测试结果**: ✅ 通过 / ❌ 失败

**通过项**: ____ / 19
**失败项**: ____ / 19

**备注**:
_______________________________________________________________________________
_______________________________________________________________________________
_______________________________________________________________________________

---

## 附录：快捷键列表

| 按键 | 功能 |
|------|------|
| B | 添加基础字段 |
| C | 添加自定义字段 |
| F | 添加固定值 |
| Q | 快速添加常用字段 |
| A | 添加所有基础字段 |
| Del | 删除最后一个字段 |
| Esc | 关闭对话框 |
| Ctrl+S | 保存配置 |
| W | 打开 WHERE 条件 |
| H | 打开 HQL 预览 |
| ? | 显示快捷键帮助 |

---

## 修改日志

| 日期 | 版本 | 修改内容 |
|------|------|---------|
| 2026-02-19 | 1.0 | 创建测试计划 |
