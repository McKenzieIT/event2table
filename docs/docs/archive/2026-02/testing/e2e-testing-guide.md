# E2E Testing Guide - End-to-End Testing

> **版本**: 1.0
> **创建日期**: 2026-02-11
> **目的**: 确保每次代码修改后进行完整的E2E测试
> **执行者**: 开发人员（每次修改后必须执行）

---

## ⚠️ 强制规则

**每次修改以下内容后，必须执行本E2E测试**：

1. ✅ 修改任何组件代码
2. ✅ 修改任何导入/导出
3. ✅ 修改任何API路由
4. ✅ 修改任何样式文件
5. ✅ 修改任何配置文件

**违反后果**: 可能导致生产环境出现用户可见的错误

---

## 🚀 测试前准备

### 1. 启动开发服务器

```bash
cd /Users/mckenzie/Documents/event2table/frontend
npm run dev
```

**预期输出**:
```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
  ➜  press h + enter to show help
```

**如果有错误**:
- ❌ 检查控制台错误信息
- ❌ 修复错误后重新启动
- ❌ 不要继续测试直到服务器正常启动

### 2. 打开浏览器

访问: http://localhost:5173

**预期**: 页面正常加载，无控制台错误

---

## 📝 E2E测试清单

### Phase 1: 核心页面测试

#### 1.1 Dashboard (首页)

**URL**: http://localhost:5173/ 或 http://localhost:5173/dashboard

**检查项**:
- [ ] 页面正常加载
- [ ] 统计卡片显示正确（游戏总数、事件总数、参数总数）
- [ ] 快速操作卡片显示（4个）
- [ ] 快速操作卡片可点击
- [ ] 最近游戏列表显示（如果有游戏数据）
- [ ] Badge显示正确（游戏卡片上的事件/参数数量）
- [ ] 控制台无错误

**实际测试步骤**:
1. 打开浏览器访问上述URL
2. 检查是否显示"Event2Table"
3. 检查是否显示4个统计卡片
4. 检查是否显示4个快速操作卡片
5. 点击"管理游戏"卡片，应该跳转到 `/games`
6. 打开浏览器控制台（F12），检查是否有错误

---

#### 1.2 Games List (游戏列表)

**URL**: http://localhost:5173/games

**检查项**:
- [ ] 页面正常加载
- [ ] 搜索框显示且可输入
- [ ] 游戏卡片显示（如果有游戏数据）
- [ ] 游戏卡片上的checkbox可点击
- [ ] "新增游戏"按钮可点击
- [ ] 点击游戏卡片的"编辑"按钮，应该跳转到编辑页面
- [ ] 点击游戏卡片的"跳转"按钮，应该跳转到Canvas页面
- [ ] 选择多个游戏后，"删除选中"按钮可点击
- [ ] Badge显示正确（游戏卡片上的状态）
- [ ] 控制台无错误

**实际测试步骤**:
1. 访问上述URL
2. 在搜索框中输入游戏名称，检查过滤是否正常
3. 点击游戏卡片的checkbox，检查是否选中
4. 点击"编辑"按钮，检查是否跳转到编辑页面
5. 点击"跳转"按钮，检查是否跳转到Canvas页面
6. 选择2个游戏，检查"删除选中"按钮是否显示
7. 点击"新增游戏"按钮，检查是否跳转到创建页面
8. 打开控制台，检查是否有错误

---

#### 1.3 Events List (事件列表)

**URL**: http://localhost:5173/events

**前置条件**: 必须先选择游戏（点击"选择游戏"按钮）

**检查项**:
- [ ] 未选择游戏时显示"请先选择游戏"提示
- [ ] 选择游戏后显示事件列表
- [ ] 搜索框显示且可输入
- [ ] 分类筛选下拉框显示
- [ ] 事件列表表格显示
- [ ] 事件行上的checkbox可点击
- [ ] "全选"checkbox可点击
- [ ] "新增事件"按钮可点击
- [ ] "导入Excel"按钮可点击
- [ ] 点击事件的"查看"按钮，应该跳转到详情页面
- [ ] 点击事件的"编辑"按钮，应该跳转到编辑页面
- [ ] 点击事件的"删除"按钮，应该显示确认对话框
- [ ] 分页控件显示（如果有多个事件）
- [ ] 每页显示数量下拉框显示
- [ ] Badge显示正确（分类标签、参数数量）
- [ ] 控制台无错误

**实际测试步骤**:
1. 访问上述URL
2. 检查是否显示"请先选择游戏"提示
3. 点击"选择游戏"按钮，选择一个游戏
4. 检查事件列表是否显示
5. 在搜索框中输入事件名称，检查过滤是否正常
6. 使用分类筛选下拉框，检查过滤是否正常
7. 点击"全选"checkbox，检查是否所有事件都被选中
8. 点击事件的"查看"按钮，检查是否跳转到详情页面
9. 点击事件的"编辑"按钮，检查是否跳转到编辑页面
10. 点击事件的"删除"按钮，检查是否显示确认对话框
11. 点击"新增事件"按钮，检查是否跳转到创建页面
12. 使用分页控件，检查分页是否正常
13. 打开控制台，检查是否有错误

---

#### 1.4 Generate Page (HQL生成)

**URL**: http://localhost:5173/generate

**前置条件**: 必须先选择游戏

**检查项**:
- [ ] 未选择游戏时显示提示
- [ ] 选择游戏后显示事件列表
- [ ] 事件卡片可点击
- [ ] 选择事件后"生成HQL"按钮可点击
- [ ] 点击"生成HQL"后显示加载状态
- [ ] 生成成功后显示Toast通知
- [ ] 生成成功后跳转到结果页面
- [ ] 控制台无错误

**实际测试步骤**:
1. 访问上述URL
2. 点击"选择游戏"按钮，选择一个游戏
3. 检查事件列表是否显示
4. 点击一个事件卡片，检查是否显示选中状态
5. 点击"生成HQL"按钮
6. 检查是否显示加载状态
7. 检查是否显示成功Toast通知
8. 检查是否跳转到结果页面
9. 打开控制台，检查是否有错误

---

#### 1.5 Canvas Page (画布)

**URL**: http://localhost:5173/canvas

**前置条件**: 必须先选择游戏

**检查项**:
- [ ] 未选择游戏时显示提示
- [ ] 选择游戏后显示Canvas画布
- [ ] 工具栏按钮可点击
- [ ] 侧边栏显示事件节点
- [ ] 可以从侧边栏拖拽节点到画布
- [ ] 节点可以连接
- [ ] 缩放/平移功能正常
- [ ] 保存流程按钮可点击
- [ ] 生成HQL按钮可点击
- [ ] Toast通知正常显示
- [ ] 控制台无错误

**实际测试步骤**:
1. 访问上述URL
2. 点击"选择游戏"按钮，选择一个游戏
3. 检查Canvas画布是否显示
4. 检查工具栏是否显示
5. 从侧边栏拖拽一个节点到画布
6. 尝试连接两个节点
7. 使用鼠标滚轮缩放画布
8. 按住鼠标中键平移画布
9. 点击"保存流程"按钮，检查是否显示Toast通知
10. 打开控制台，检查是否有错误

---

### Phase 2: 表单测试

#### 2.1 Game Form (游戏创建/编辑)

**URL**:
- 创建: http://localhost:5173/games/create
- 编辑: http://localhost:5173/games/10000147/edit (替换为实际的游戏GID)

**检查项**:
- [ ] 表单正常加载
- [ ] 游戏GID输入框显示且可输入
- [ ] 游戏名称输入框显示且可输入
- [ ] ODS数据库类型选择显示
- [ ] "返回游戏列表"按钮可点击
- [ ] "创建游戏"/"保存修改"按钮可点击
- [ ] 点击"取消"按钮，应该跳转到游戏列表
- [ ] 提交表单后显示加载状态
- [ ] 创建成功后显示成功Toast通知
- [ ] 创建成功后跳转到游戏列表
- [ ] 输入框有focus glow效果
- [ ] 控制台无错误

**实际测试步骤**:
1. 访问上述URL
2. 检查所有输入框是否显示
3. 在GID输入框中输入"99999999"
4. 在名称输入框中输入"测试游戏"
5. 选择ODS数据库类型
6. 点击"取消"按钮，检查是否跳转回游戏列表
7. 重新进入表单页面
8. 填写表单，点击"创建游戏"按钮
9. 检查是否显示加载状态
10. 检查是否显示成功Toast通知
11. 检查是否跳转到游戏列表
12. 点击输入框，检查是否有focus glow效果
13. 打开控制台，检查是否有错误

---

#### 2.2 Event Form (事件创建/编辑)

**URL**:
- 创建: http://localhost:5173/events/create
- 编辑: http://localhost:5173/events/1/edit?game_gid=10000147 (替换为实际的事件ID和游戏GID)

**检查项**:
- [ ] 表单正常加载
- [ ] 所有输入框显示且可输入
- [ ] 分类选择下拉框显示
- [ ] Checkbox可点击
- [ ] "返回"按钮可点击
- [ ] "创建事件"/"保存修改"按钮可点击
- [ ] 提交表单后显示加载状态
- [ ] 创建成功后显示成功Toast通知
- [ ] 创建成功后跳转到事件列表
- [ ] 输入框有focus glow效果
- [ ] 控制台无错误

**实际测试步骤**:
1. 访问上述URL
2. 检查所有输入框是否显示
3. 填写事件名称和中文名称
4. 选择分类
5. 点击Checkbox，检查是否选中
6. 点击"取消"按钮，检查是否跳转回事件列表
7. 重新进入表单页面
8. 填写表单，点击"创建事件"按钮
9. 检查是否显示加载状态
10. 检查是否显示成功Toast通知
11. 点击输入框，检查是否有focus glow效果
12. 打开控制台，检查是否有错误

---

### Phase 3: Toast通知测试

**检查项**:
- [ ] 成功操作后显示绿色Toast通知
- [ ] 错误操作后显示红色Toast通知
- [ ] Toast通知自动消失（3秒后）
- [ ] Toast通知显示在右上角
- [ ] 多个Toast通知可以堆叠显示
- [ ] Toast通知有关闭按钮

**实际测试步骤**:
1. 创建一个游戏（会触发成功Toast）
2. 检查Toast通知是否显示在右上角
3. 检查Toast通知是否是绿色（成功）
4. 等待3秒，检查Toast通知是否自动消失
5. 创建一个游戏但使用重复的GID（会触发错误Toast）
6. 检查Toast通知是否显示在右上角
7. 检查Toast通知是否是红色（错误）
8. 点击Toast通知的关闭按钮，检查是否立即消失
9. 打开控制台，检查是否有错误

---

### Phase 4: 组件样式测试

**检查项**:
- [ ] Button组件有hover效果
- [ ] Button组件有正确的颜色（primary=青色, danger=红色）
- [ ] Card组件有玻璃态效果
- [ ] Input组件有focus glow效果
- [ ] Badge组件有正确的颜色
- [ ] Spinner组件有旋转动画
- [ ] 所有组件使用Cyberpunk Lab主题

**实际测试步骤**:
1. 访问任何页面
2. 鼠标悬停在Button上，检查是否有hover效果
3. 点击Input输入框，检查是否有focus glow效果
4. 检查Card是否有玻璃态效果（半透明背景）
5. 检查Badge颜色是否正确（success=绿色, danger=红色）
6. 触发任何加载操作，检查Spinner是否有旋转动画
7. 打开控制台，检查是否有错误

---

### Phase 5: 性能测试

**检查项**:
- [ ] 页面首次加载时间 < 3秒
- [ ] 页面切换流畅，无明显卡顿
- [ ] 滚动页面流畅
- [ ] 输入框输入响应迅速
- [ ] 按钮点击反馈及时
- [ ] 控制台无警告（特别是React警告）

**实际测试步骤**:
1. 使用浏览器性能工具记录加载时间
2. 浏览不同页面，检查是否有卡顿
3. 滚动页面，检查是否流畅
4. 在输入框中快速输入，检查是否有延迟
5. 点击按钮，检查是否有延迟
6. 打开控制台，检查是否有React警告

---

## ❌ 错误处理

### 如果发现错误：

1. **记录错误信息**:
   - 错误页面URL
   - 浏览器控制台错误信息
   - 网络请求错误（如果有）
   - 复现步骤

2. **修复错误**:
   - 根据错误信息定位问题
   - 修复代码
   - 重新启动开发服务器（如果需要）

3. **重新测试**:
   - 重新执行失败的测试项
   - 确保修复没有引入新问题
   - 执行所有测试，确保没有回归

---

## ✅ 测试通过标准

所有以下条件必须满足：

- [ ] 所有页面正常加载
- [ ] 所有核心功能正常工作
- [ ] 所有交互元素响应正确
- [ ] Toast通知正常显示
- [ ] 控制台无错误
- [ ] 控制台无警告
- [ ] 性能表现良好

---

## 📊 测试报告模板

每次测试完成后，填写以下报告：

```
测试日期: YYYY-MM-DD
测试人员: [您的名字]
代码修改: [描述修改的内容]

测试结果:
- Dashboard: ✅ / ❌ [备注]
- Games List: ✅ / ❌ [备注]
- Events List: ✅ / ❌ [备注]
- Generate: ✅ / ❌ [备注]
- Canvas: ✅ / ❌ [备注]
- Game Form: ✅ / ❌ [备注]
- Event Form: ✅ / ❌ [备注]

发现的问题:
[列出所有发现的问题]

修复措施:
[描述如何修复]

重新测试:
[重新测试后填写结果]
```

---

## 🎯 强制执行规则

1. **每次代码修改后必须执行本E2E测试**
2. **发现错误必须立即修复**
3. **修复后必须重新测试**
4. **测试通过后才能提交代码**
5. **严禁跳过任何测试步骤**

违反以上规则将导致：
- ❌ 生产环境出现错误
- ❌ 用户体验受损
- ❌ 技术债务累积
- ❌ 团队效率下降

---

**文档版本**: 1.0
**最后更新**: 2026-02-11
**维护者**: Event2Table Development Team
