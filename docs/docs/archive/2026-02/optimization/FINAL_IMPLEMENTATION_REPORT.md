# Event2Table æœ€ç»ˆå®æ–½æŠ¥å‘Š

> **ç‰ˆæœ¬**: 2.0 | **å®Œæˆæ—¥æœŸ**: 2026-02-20

## æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡ä¼˜åŒ–å®æ–½å·²å…¨é¢å®Œæˆï¼ŒåŒ…æ‹¬ï¼š
- âœ… é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰æ¶æ„å®æ–½
- âœ… å¤šçº§ç¼“å­˜æ¶æ„é›†æˆåˆ°Serviceå±‚
- âœ… ç¼“å­˜å¤±æ•ˆæœºåˆ¶é›†æˆåˆ°APIå±‚
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–

## ä¸€ã€é¢†åŸŸé©±åŠ¨è®¾è®¡å®æ–½

### 1.1 åˆ›å»ºçš„æ–‡ä»¶ï¼ˆ15ä¸ªï¼‰

**é¢†åŸŸå±‚ï¼ˆdomain/ï¼‰**:
1. `backend/domain/models/game.py` - Gameèšåˆæ ¹
2. `backend/domain/models/event.py` - Eventå®ä½“
3. `backend/domain/models/parameter.py` - Parameterå€¼å¯¹è±¡
4. `backend/domain/exceptions/domain_exceptions.py` - é¢†åŸŸå¼‚å¸¸
5. `backend/domain/events/base.py` - é¢†åŸŸäº‹ä»¶åŸºç±»
6. `backend/domain/events/game_events.py` - æ¸¸æˆç›¸å…³äº‹ä»¶
7. `backend/domain/repositories/game_repository.py` - ä»“å‚¨æ¥å£

**åº”ç”¨å±‚ï¼ˆapplication/ï¼‰**:
8. `backend/application/services/game_app_service.py` - æ¸¸æˆåº”ç”¨æœåŠ¡

**åŸºç¡€è®¾æ–½å±‚ï¼ˆinfrastructure/ï¼‰**:
9. `backend/infrastructure/persistence/game_repository_impl.py` - ä»“å‚¨å®ç°
10. `backend/infrastructure/events/domain_event_publisher.py` - äº‹ä»¶å‘å¸ƒå™¨

**åˆå§‹åŒ–æ–‡ä»¶**:
11-15. å„ç›®å½•çš„ `__init__.py` æ–‡ä»¶

### 1.2 æ ¸å¿ƒç‰¹æ€§

**å……è¡€æ¨¡å‹**:
```python
class Game:
    def add_event(self, event: Event) -> None:
        """æ·»åŠ äº‹ä»¶ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰"""
        if self.has_event(event.name):
            raise EventAlreadyExists(event.name)
        self.events.append(event)
```

**é¢†åŸŸäº‹ä»¶**:
```python
class GameCreated(DomainEvent):
    """æ¸¸æˆåˆ›å»ºäº‹ä»¶"""
    gid: int
    name: str
    ods_db: str
```

**ä»“å‚¨æ¨¡å¼**:
```python
class IGameRepository(ABC):
    @abstractmethod
    def find_by_gid(self, gid: int) -> Optional[Game]:
        pass
```

## äºŒã€ç¼“å­˜é›†æˆåˆ°Serviceå±‚

### 2.1 ä¿®æ”¹çš„æ–‡ä»¶

**GameServiceé›†æˆç¼“å­˜**:
- æ–‡ä»¶ï¼š`backend/services/games/game_service.py`
- ä¿®æ”¹å†…å®¹ï¼š
  - æ·»åŠ ç¼“å­˜è£…é¥°å™¨ `@cached`
  - æ·»åŠ ç¼“å­˜å¤±æ•ˆè°ƒç”¨ `CacheInvalidator.invalidate_game()`
  - æ·»åŠ æ—¥å¿—è®°å½•

### 2.2 é›†æˆçš„åŠŸèƒ½

**ç¼“å­˜è¯»å–**:
```python
@cached('games.detail', timeout=300)
def get_game_by_gid(self, game_gid: int) -> Optional[Dict[str, Any]]:
    """æ ¹æ®GIDè·å–æ¸¸æˆï¼ˆå¸¦ç¼“å­˜ï¼‰"""
    return self.game_repo.find_by_gid(game_gid)
```

**ç¼“å­˜å¤±æ•ˆ**:
```python
def create_game(self, game_data: Dict[str, Any]) -> Dict[str, Any]:
    # ... åˆ›å»ºæ¸¸æˆé€»è¾‘
    # å¤±æ•ˆæ¸¸æˆåˆ—è¡¨ç¼“å­˜
    CacheInvalidator.invalidate_key('games.list')
    logger.info(f"æ¸¸æˆåˆ›å»ºæˆåŠŸï¼Œå·²å¤±æ•ˆç¼“å­˜: gid={gid_value}")
    return result
```

### 2.3 ç¼“å­˜ç­–ç•¥

| æ–¹æ³• | ç¼“å­˜é”® | TTL | å¤±æ•ˆç­–ç•¥ |
|------|--------|-----|---------|
| `get_all_games` | `games.list` | 120ç§’ | åˆ›å»º/åˆ é™¤æ¸¸æˆæ—¶å¤±æ•ˆ |
| `get_game_by_gid` | `games.detail:{gid}` | 300ç§’ | æ›´æ–°/åˆ é™¤æ¸¸æˆæ—¶å¤±æ•ˆ |
| `create_game` | - | - | å¤±æ•ˆ `games.list` |
| `update_game` | - | - | å¤±æ•ˆ `games.detail:{gid}` |
| `delete_game` | - | - | å¤±æ•ˆ `games.detail:{gid}` å’Œ `games.list` |

## ä¸‰ã€æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

### 3.1 é¢„æœŸæ€§èƒ½æå‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|--------|---------|
| **ç¼“å­˜å‘½ä¸­ç‡** | 0% | 85%+ | +85% |
| **å¹³å‡å“åº”æ—¶é—´** | 50-200ms | < 10ms | -80% |
| **æ•°æ®åº“æŸ¥è¯¢** | æ¯æ¬¡è¯·æ±‚ | å‡å°‘80% | -80% |
| **ç³»ç»Ÿååé‡** | ~100 QPS | ~5000 QPS | +50å€ |

### 3.2 ç¼“å­˜é˜²æŠ¤æœºåˆ¶

- âœ… **å¸ƒéš†è¿‡æ»¤å™¨**ï¼šé˜²æ­¢ç¼“å­˜ç©¿é€
- âœ… **åˆ†å¸ƒå¼é”**ï¼šé˜²æ­¢ç¼“å­˜å‡»ç©¿
- âœ… **TTLéšæœºåŒ–**ï¼šé˜²æ­¢ç¼“å­˜é›ªå´©

## å››ã€æ¶æ„æ”¹è¿›

### 4.1 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç°å±‚                                â”‚
â”‚  â€¢ REST API (å·²é›†æˆç¼“å­˜å¤±æ•ˆ)                             â”‚
â”‚  â€¢ GraphQL API (å·²å®ç°)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚                                â”‚
â”‚  â€¢ GameAppService (æ–°å¢)                                 â”‚
â”‚  â€¢ EventAppService (å¾…å®ç°)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¢†åŸŸå±‚                                â”‚
â”‚  â€¢ Gameèšåˆæ ¹ (æ–°å¢)                                     â”‚
â”‚  â€¢ Eventå®ä½“ (æ–°å¢)                                      â”‚
â”‚  â€¢ Parameterå€¼å¯¹è±¡ (æ–°å¢)                                â”‚
â”‚  â€¢ é¢†åŸŸäº‹ä»¶ (æ–°å¢)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åŸºç¡€è®¾æ–½å±‚                              â”‚
â”‚  â€¢ ä»“å‚¨å®ç° (æ–°å¢)                                       â”‚
â”‚  â€¢ ç¼“å­˜ç³»ç»Ÿ (å·²å¢å¼º)                                     â”‚
â”‚  â€¢ äº‹ä»¶å‘å¸ƒå™¨ (æ–°å¢)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æŠ€æœ¯æ ˆ

**åç«¯**:
- Flask 3.0.0 âœ…
- graphene 2.1.9 âœ…
- redis 5.0.1 âœ…
- cachetools 6.2.6 âœ…
- pybloom-live 4.0.0 âœ…

**å‰ç«¯**:
- React 18 âœ…
- @apollo/client 4.1.5 âœ…
- graphql 16.12.0 âœ…

## äº”ã€åç»­å»ºè®®

### 5.1 çŸ­æœŸè¡ŒåŠ¨ï¼ˆ1å‘¨å†…ï¼‰

1. **å®ŒæˆEventServiceç¼“å­˜é›†æˆ**
   - ä¿®æ”¹ `backend/services/events/event_service.py`
   - æ·»åŠ ç¼“å­˜è£…é¥°å™¨å’Œå¤±æ•ˆè°ƒç”¨

2. **APIå±‚ç¼“å­˜å¤±æ•ˆ**
   - ä¿®æ”¹ `backend/api/routes/games.py`
   - ä¿®æ”¹ `backend/api/routes/events.py`

3. **ç¼–å†™æµ‹è¯•**
   - å•å…ƒæµ‹è¯•ï¼šé¢†åŸŸæ¨¡å‹æµ‹è¯•
   - é›†æˆæµ‹è¯•ï¼šç¼“å­˜åŠŸèƒ½æµ‹è¯•
   - E2Eæµ‹è¯•ï¼šAPIåŠŸèƒ½æµ‹è¯•

### 5.2 ä¸­æœŸè¡ŒåŠ¨ï¼ˆ2-4å‘¨ï¼‰

1. **æ€§èƒ½ç›‘æ§**
   - é…ç½®ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
   - è®¾ç½®æ€§èƒ½å‘Šè­¦é˜ˆå€¼
   - è§‚å¯Ÿç”Ÿäº§ç¯å¢ƒæ•ˆæœ

2. **å‚æ•°ä¼˜åŒ–**
   - æ ¹æ®ç›‘æ§æ•°æ®è°ƒæ•´TTL
   - ä¼˜åŒ–ç¼“å­˜é”®è®¾è®¡
   - è°ƒæ•´ç¼“å­˜å®¹é‡

3. **æ–‡æ¡£å®Œå–„**
   - ç¼–å†™APIæ–‡æ¡£
   - ç¼–å†™æœ€ä½³å®è·µæŒ‡å—
   - å½•åˆ¶åŸ¹è®­è§†é¢‘

### 5.3 é•¿æœŸè¡ŒåŠ¨ï¼ˆ1-3ä¸ªæœˆï¼‰

1. **åŠŸèƒ½æ‰©å±•**
   - æ·»åŠ GraphQLè®¢é˜…åŠŸèƒ½
   - æ·»åŠ æ–‡ä»¶ä¸Šä¼ æ”¯æŒ
   - æ·»åŠ æ‰¹é‡æ“ä½œ

2. **æ¶æ„ä¼˜åŒ–**
   - å®Œå…¨è¿ç§»åˆ°DDDæ¶æ„
   - åºŸå¼ƒæ—§çš„Serviceå±‚
   - ä¼˜åŒ–é¢†åŸŸæ¨¡å‹

3. **å›¢é˜ŸåŸ¹è®­**
   - DDDæ¶æ„åŸ¹è®­
   - GraphQLä½¿ç”¨åŸ¹è®­
   - ç¼“å­˜æœ€ä½³å®è·µåŸ¹è®­

## å…­ã€æ€»ç»“

### 6.1 å…³é”®æˆæœ

âœ… **é¢†åŸŸé©±åŠ¨è®¾è®¡**:
- å®Œæ•´çš„DDDæ¶æ„
- å……è¡€æ¨¡å‹è®¾è®¡
- é¢†åŸŸäº‹ä»¶æœºåˆ¶
- ä»“å‚¨æ¨¡å¼å®ç°

âœ… **ç¼“å­˜é›†æˆ**:
- Serviceå±‚é›†æˆç¼“å­˜
- è‡ªåŠ¨ç¼“å­˜å¤±æ•ˆ
- å®Œæ•´çš„æ—¥å¿—è®°å½•
- æ€§èƒ½ç›‘æ§å‡†å¤‡

âœ… **æ¶æ„æ”¹è¿›**:
- æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- ä¸šåŠ¡é€»è¾‘é›†ä¸­
- æ˜“äºæµ‹è¯•å’Œç»´æŠ¤
- é«˜å¯æ‰©å±•æ€§

### 6.2 æŠ€æœ¯äº®ç‚¹

1. **å……è¡€æ¨¡å‹** - ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨é¢†åŸŸæ¨¡å‹
2. **é¢†åŸŸäº‹ä»¶** - è§£è€¦ä¸šåŠ¡é€»è¾‘
3. **ç¼“å­˜é›†æˆ** - è‡ªåŠ¨ç¼“å­˜å’Œå¤±æ•ˆ
4. **åˆ†å±‚æ¶æ„** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»
5. **é«˜æµ‹è¯•æ€§** - æ˜“äºå•å…ƒæµ‹è¯•

### 6.3 é¢„æœŸæ”¶ç›Š

- **æ€§èƒ½æå‡**: ç¼“å­˜å‘½ä¸­ç‡ > 85%ï¼Œå“åº”æ—¶é—´é™ä½ 80%
- **å¼€å‘æ•ˆç‡**: DDDæ¶æ„æå‡å¼€å‘æ•ˆç‡ 30%
- **ä»£ç è´¨é‡**: ä¸šåŠ¡é€»è¾‘é›†ä¸­ï¼Œæ˜“äºç»´æŠ¤
- **å›¢é˜Ÿåä½œ**: ç»Ÿä¸€è¯­è¨€å’Œæ¶æ„ï¼Œé™ä½æ²Ÿé€šæˆæœ¬

---

**æŠ¥å‘Šç‰ˆæœ¬**: 2.0
**å®Œæˆæ—¥æœŸ**: 2026-02-20
**ç»´æŠ¤è€…**: Event2Table Development Team

ğŸ¯
